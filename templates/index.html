{% extends 'base.html' %}
{% block content %}
  <div class="py-4 text-center">
    <h1 class="display-5">{{ site.brand_name if site and site.brand_name else 'Restaurant Menu' }}</h1>
    <p class="text-muted">Browse our categories and dishes below.</p>
  </div>

  {% if categories %}
    <div class="row g-4">
      {% for cat in categories %}
      <div class="col-12">
        <h3 class="border-bottom pb-2">{{ cat.name }}</h3>
        {% set items = items_by_cat.get(cat.id, []) %}
          <div class="row g-3 mb-4">
            {% for item in items %}
              <div class="col-md-6">
                <div class="list-group-item p-3 d-flex align-items-center">
                  {% if item.image_url %}
                    <img src="{{ item.image_url }}" alt="" class="me-3" style="height:64px;width:64px;object-fit:cover;border-radius:10px;">
                  {% endif %}
                  <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="fw-bold">{{ item.name }}</div>
                      {% if item.price is not none %}
                        <span class="badge bg-dark rounded-pill">${{ '%.2f'|format(item.price) }}</span>
                      {% endif %}
                    </div>
                    {% if item.description %}<div class="small text-muted">{{ item.description }}</div>{% endif %}
                    <div class="small mt-1">In stock: {{ item.quantity if item.quantity is not none else 0 }}</div>
                    <form class="mt-2 d-flex align-items-center gap-2" method="post" action="/cart/add">
                      <input type="hidden" name="item_id" value="{{ item.id }}">
                      {% set stock = item.quantity if item.quantity is not none else 0 %}
                      <input type="number" class="form-control form-control-sm" name="qty" value="1" min="1" {% if stock>0 %}max="{{ stock }}"{% endif %} style="width:90px" {% if stock<=0 %}disabled{% endif %}>
                      <button class="btn btn-sm btn-dark" {% if stock<=0 %}disabled{% endif %}>{% if stock<=0 %}Sold out{% else %}Add to Cart{% endif %}</button>
                    </form>
                  </div>
                </div>
              </div>
            {% endfor %}
        {% else %}
          <p class="text-muted">No items yet.</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No categories yet.</p>
  {% endif %}
{% endblock %}
